<app-header></app-header>
<div *ngIf="project" class="container mt-5">
  <!-- Titre du projet -->
  <div class="card project-card">
    <div class="card-body">
      <h1 class="project-title">{{ project.name }}</h1>
      <p class="project-description">{{ project.description }}</p>
    </div>
    <div class="mt-2 mb-2">
      <!-- Bouton pour activer la modification -->
      <button
        *ngIf="user.role === 'ADMIN'"
        class="btn btn-sm btn-outline-primary mt-2"
        (click)="editMode = !editMode"
      >
        {{ editMode ? "Annuler" : "Modifier le projet" }}
      </button>

      <!-- Formulaire de modification -->
      <form *ngIf="editMode" (ngSubmit)="onUpdateProject()" class="mt-3">
        <div class="mb-2">
          <label>Nom du projet :</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="editableProject.name"
            name="name"
            required
          />
        </div>
        <div class="mb-2">
          <label>Description :</label>
          <textarea
            class="form-control"
            [(ngModel)]="editableProject.description"
            name="description"
            required
          ></textarea>
        </div>
        <button class="btn btn-success" type="submit">Enregistrer</button>
      </form>
    </div>
  </div>

  <!-- Membres du projet -->
  <div class="mt-4">
    <div class="d-flex gap-4 mb-3">
      <h3>Membres du projet</h3>
      <app-add-member-modal
        *ngIf="user.role === 'ADMIN'"
        [projectId]="project.id"
        [projectAdminId]="project.creator.id"
        [projectMembers]="project.members"
        (memberAdded)="refreshProject()"
      ></app-add-member-modal>
    </div>

    <div class="members-list">
      <div *ngFor="let member of project.members" class="card member-card">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <h5 class="member-name">{{ member.user.username }}</h5>

            <!-- ✅ Bouton de suppression -->
            <button
              *ngIf="user.role === 'ADMIN'"
              class="btn btn-close"
              (click)="onDeleteMember(member.user.id)"
              aria-label="Remove member"
            ></button>
          </div>
          <span class="badge" [ngClass]="getRoleClass(member.role)">
            {{ member.role }}
          </span>
        </div>
      </div>
    </div>

    <!-- Tâches -->
    <div class="mt-4">
      <h3>Tâches</h3>

      <app-task-adder
        [projectId]="project.id"
        [members]="project.members"
        (taskCreated)="refreshProject()"
        *ngIf="user.role === 'ADMIN'"
        [user]="user"
      ></app-task-adder>

      <!-- <div class="tasks-list">
        <div *ngFor="let task of project.tasks" class="card task-card">
          <div class="card-body">
            <h5 class="task-name">{{ task.name }}</h5>
            <p class="task-status">
              Statut :
              <span [ngClass]="getStatusClass(task.status)">
                {{ task.status }}
              </span>
            </p>
            <p class="task-assignee">
              Assigné à :
              {{ task.assignedUser?.username || "Non assigné" }}
            </p>
          </div>
        </div>
      </div> -->
      <div class="tasks-list">
        <app-task
          *ngFor="let task of project.tasks"
          [task]="task"
          [user]="user"
          (taskDeleted)="refreshProject()"
        ></app-task>
      </div>
    </div>
  </div>
</div>
